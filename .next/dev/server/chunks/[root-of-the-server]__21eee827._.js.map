{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prabe/Desktop/credit_card_fraud_detection/pages/api/predict.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport { execSync } from \"child_process\";\r\n\r\nconst GEMINI_API_KEY = process.env.GEMINI_KEY;\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  if (req.method !== \"POST\") return res.status(405).end();\r\n\r\n  try {\r\n    const { features } = req.body; // should be array of 30 numbers\r\n\r\n    if (!Array.isArray(features) || features.length !== 30) {\r\n      return res.status(400).json({ error: \"Features must be an array of 30 numbers\" });\r\n    }\r\n\r\n    // -----------------------------\r\n    // Run Python ML prediction\r\n    // -----------------------------\r\n    const pyOutput = execSync(\r\n      `python models/predict.py '${JSON.stringify(features)}'`,\r\n      { encoding: \"utf-8\" }\r\n    );\r\n\r\n    const pyResult = JSON.parse(pyOutput); // { prediction: 0 or 1 }\r\n\r\n    // -----------------------------\r\n    // Gemini API call\r\n    // -----------------------------\r\n    const prompt = `A credit card transaction has features: ${JSON.stringify(\r\n      features\r\n    )}. The ML model predicted: ${\r\n      pyResult.prediction === 1 ? \"Fraud\" : \"Not Fraud\"\r\n    }. Explain why.`;\r\n\r\n   const geminiRes = await fetch(\r\n  `https://generativelanguage.googleapis.com/v1beta2/models/gemini-1:generateMessage?key=${GEMINI_API_KEY}`,\r\n  {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      prompt: { messages: [{ author: \"user\", content: prompt }] },\r\n      temperature: 0.6,\r\n      max_output_tokens: 180,\r\n    }),\r\n  }\r\n);\r\n\r\nconst geminiData = await geminiRes.json(); // read once\r\nconsole.log(\"Gemini response:\", geminiData);\r\n\r\nconst reasoning =\r\n  geminiData?.candidates?.[0]?.content?.[0]?.text ||\r\n  JSON.stringify(geminiData); // show raw if something is wrong\r\n\r\n    // -----------------------------\r\n    // Send response\r\n    // -----------------------------\r\n    res.status(200).json({ prediction: pyResult.prediction, reasoning });\r\n  } catch (err: any) {\r\n    console.error(\"API error:\", err);\r\n    res.status(500).json({ error: err.message || String(err) });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,iBAAiB,QAAQ,GAAG,CAAC,UAAU;AAE9B,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAErD,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI,EAAE,gCAAgC;QAE/D,IAAI,CAAC,MAAM,OAAO,CAAC,aAAa,SAAS,MAAM,KAAK,IAAI;YACtD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA0C;QACjF;QAEA,gCAAgC;QAChC,2BAA2B;QAC3B,gCAAgC;QAChC,MAAM,WAAW,IAAA,+HAAQ,EACvB,CAAC,0BAA0B,EAAE,KAAK,SAAS,CAAC,UAAU,CAAC,CAAC,EACxD;YAAE,UAAU;QAAQ;QAGtB,MAAM,WAAW,KAAK,KAAK,CAAC,WAAW,yBAAyB;QAEhE,gCAAgC;QAChC,kBAAkB;QAClB,gCAAgC;QAChC,MAAM,SAAS,CAAC,wCAAwC,EAAE,KAAK,SAAS,CACtE,UACA,0BAA0B,EAC1B,SAAS,UAAU,KAAK,IAAI,UAAU,YACvC,cAAc,CAAC;QAEjB,MAAM,YAAY,MAAM,MACzB,CAAC,sFAAsF,EAAE,gBAAgB,EACzG;YACE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,QAAQ;oBAAE,UAAU;wBAAC;4BAAE,QAAQ;4BAAQ,SAAS;wBAAO;qBAAE;gBAAC;gBAC1D,aAAa;gBACb,mBAAmB;YACrB;QACF;QAGF,MAAM,aAAa,MAAM,UAAU,IAAI,IAAI,YAAY;QACvD,QAAQ,GAAG,CAAC,oBAAoB;QAEhC,MAAM,YACJ,YAAY,YAAY,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE,EAAE,QAC3C,KAAK,SAAS,CAAC,aAAa,iCAAiC;QAE3D,gCAAgC;QAChC,gBAAgB;QAChB,gCAAgC;QAChC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,YAAY,SAAS,UAAU;YAAE;QAAU;IACpE,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,cAAc;QAC5B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI,OAAO;QAAK;IAC3D;AACF"}}]
}