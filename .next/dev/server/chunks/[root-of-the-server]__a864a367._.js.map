{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prabe/Desktop/credit_card_fraud_detection/pages/api/predict.ts"],"sourcesContent":["// pages/api/predict.ts\r\nimport type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport { spawn } from \"child_process\";\r\nimport path from \"path\";\r\n\r\nconst GEMINI_API_KEY = process.env.GEMINI_KEY;\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  if (req.method !== \"POST\") return res.status(405).end();\r\n\r\n  const { features } = req.body;\r\n\r\n  if (!features || features.length !== 30) {\r\n    return res.status(400).json({ error: \"Features must be a 30-element array\" });\r\n  }\r\n\r\n  try {\r\n    const predictPath = path.join(process.cwd(), \"models\", \"predict.py\");\r\n    const pythonPath = \"python\"; // or full path to Python if needed\r\n\r\n    const py = spawn(pythonPath, [predictPath, JSON.stringify(features)]);\r\n\r\n    let output = \"\";\r\n    let errorOutput = \"\";\r\n\r\n    py.stdout.on(\"data\", (data) => (output += data.toString()));\r\n    py.stderr.on(\"data\", (data) => (errorOutput += data.toString()));\r\n\r\n    py.on(\"close\", async () => {\r\n      if (errorOutput) console.error(\"PYTHON ERROR:\", errorOutput);\r\n\r\n      try {\r\n        const result = JSON.parse(output);\r\n\r\n        // Call Gemini API for reasoning\r\n        const prompt = `\r\nA credit card transaction has the following features:\r\n${JSON.stringify(features)}\r\n\r\nThe ML model predicted: ${result.prediction === 1 ? \"Fraud\" : \"Not Fraud\"}\r\n\r\nExplain simply why this transaction might be considered fraudulent or not.\r\n`;\r\n\r\n        const geminiRes = await fetch(\r\n          `https://generativelanguage.googleapis.com/v1beta2/models/gemini-1:generateMessage?key=${GEMINI_API_KEY}`,\r\n          {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n              prompt: { messages: [{ author: \"user\", content: prompt }] },\r\n              temperature: 0.6,\r\n              max_output_tokens: 180,\r\n            }),\r\n          }\r\n        );\r\n\r\n        const geminiData = await geminiRes.json();\r\n        const reasoning = geminiData?.candidates?.[0]?.content?.[0]?.text || \"\";\r\n\r\n        res.status(200).json({ prediction: result.prediction, reasoning });\r\n      } catch (e) {\r\n        const errorMessage = e instanceof Error ? e.message : String(e);\r\n        res.status(500).json({ error: errorMessage });\r\n      }\r\n    });\r\n  } catch (err: unknown) {\r\n    const errorMessage = err instanceof Error ? err.message : String(err);\r\n    res.status(500).json({ error: errorMessage });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AAEvB;AACA;;;AAEA,MAAM,iBAAiB,QAAQ,GAAG,CAAC,UAAU;AAE9B,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAErD,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAE7B,IAAI,CAAC,YAAY,SAAS,MAAM,KAAK,IAAI;QACvC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAsC;IAC7E;IAEA,IAAI;QACF,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QACvD,MAAM,aAAa,UAAU,mCAAmC;QAEhE,MAAM,KAAK,IAAA,4HAAK,EAAC,YAAY;YAAC;YAAa,KAAK,SAAS,CAAC;SAAU;QAEpE,IAAI,SAAS;QACb,IAAI,cAAc;QAElB,GAAG,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAU,UAAU,KAAK,QAAQ;QACvD,GAAG,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAU,eAAe,KAAK,QAAQ;QAE5D,GAAG,EAAE,CAAC,SAAS;YACb,IAAI,aAAa,QAAQ,KAAK,CAAC,iBAAiB;YAEhD,IAAI;gBACF,MAAM,SAAS,KAAK,KAAK,CAAC;gBAE1B,gCAAgC;gBAChC,MAAM,SAAS,CAAC;;AAExB,EAAE,KAAK,SAAS,CAAC,UAAU;;wBAEH,EAAE,OAAO,UAAU,KAAK,IAAI,UAAU,YAAY;;;AAG1E,CAAC;gBAEO,MAAM,YAAY,MAAM,MACtB,CAAC,sFAAsF,EAAE,gBAAgB,EACzG;oBACE,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,QAAQ;4BAAE,UAAU;gCAAC;oCAAE,QAAQ;oCAAQ,SAAS;gCAAO;6BAAE;wBAAC;wBAC1D,aAAa;wBACb,mBAAmB;oBACrB;gBACF;gBAGF,MAAM,aAAa,MAAM,UAAU,IAAI;gBACvC,MAAM,YAAY,YAAY,YAAY,CAAC,EAAE,EAAE,SAAS,CAAC,EAAE,EAAE,QAAQ;gBAErE,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,YAAY,OAAO,UAAU;oBAAE;gBAAU;YAClE,EAAE,OAAO,GAAG;gBACV,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG,OAAO;gBAC7D,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAa;YAC7C;QACF;IACF,EAAE,OAAO,KAAc;QACrB,MAAM,eAAe,eAAe,QAAQ,IAAI,OAAO,GAAG,OAAO;QACjE,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAa;IAC7C;AACF"}}]
}